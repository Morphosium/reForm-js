var main=function(e){"use strict";class t{constructor(e){this.content=e.content}}function i(e,t){for(const i in e)if("__proto__"!=i&&Object.prototype.hasOwnProperty.call(e,i)&&"function"!=typeof e[i]){const s=e[i];t[i]=s}}class s extends t{constructor(e){super(e),this.isSection=!0,this.root=!1,i(e,this),this.convertToFinalValue=e.convertToFinalValue}}class n{constructor(){this.observers=[]}notify(e){for(const t of this.observers)t.update(this,e)}subscribe(e){-1==this.observers.indexOf(e)&&this.observers.push(e)}unsubscribe(e){const t=this.observers.indexOf(e);t>-1&&this.observers.splice(t,1)}}class l{}class a extends l{constructor(e){super(),this.updateEvent=e}update(e,t){this.updateEvent(t)}}class o{}class r extends o{constructor(e,t,i,s){super(),this.elementField=e,this.reflector=t,this.baseElement=i,this.parentSectionReflection=s,this.constructReflection()}constructReflection(){this.initialField=this.elementField;const e=function(e,t){var i,s;const n=document.createElement(e.tag||"div");this.element=n,e.class&&(n.className=e.class);const l=null===(i=e.attributes)||void 0===i?void 0:i.filter(e=>null!=e);if((null==l?void 0:l.length)>0)for(let e=0;e<l.length;e++){const t=l[e];("class"!=t.key&&"style"!=t.key||t.value)&&n.setAttribute(t.key,t.value||"")}for(const i in e.eventBindings||{})if(Object.prototype.hasOwnProperty.call(e.eventBindings,i)){const l=null===(s=e.eventBindings[i])||void 0===s?void 0:s.filter(e=>null!=e);for(let e=0;e<(null==l?void 0:l.length);e++){const s=null==l?void 0:l[e];n.addEventListener(i,e=>{s(this,e,t)})}}return n}(this.elementField,this.reflector);this.baseElement.appendChild(e),"string"==typeof this.elementField.content?e.textContent=this.elementField.content:this.subReflections=this.reflector.expand(e,this.elementField,this.parentSectionReflection),this.element=e}getElementByName(e){var t;return null===(t=this.subReflections)||void 0===t?void 0:t.find(t=>t.name===e)}setErrorMessageVisibility(e){}}class c extends o{constructor(e,t,i,s){super(),this.reflector=t,this.parentSectionReflection=s,this.value="",this.validationErrors={},this.value=e.initialValue,this.initialField=e,this.constructReflection(e,t,i,s)}constructReflection(e,t,i,s){this._baseElement&&(this._baseElement.innerHTML="",this._baseElement.innerText="");let n,l,a,o=e.template||"\n            <div>$label</div>\n            <div>$input</div>\n            <div>$message</div>";"checkbox"===e.inputType?(n=`<input reformjs-input type="checkbox"> <span reformjs-input-label>${e.label}</span>`,l="<span></span>"):(n=`<input reformjs-input type="${e.inputType}">`,l=`<span reformjs-input-label>${e.label}</span>`),a="<span reformjs-message></span>";const r=o.replace("$label",l).replace("$input",n).replace("$message","<span reformjs-message></span>"),c=document.createElement("div");c.innerHTML=r;const h=c.querySelector("[reformjs-input]"),u=c.querySelector("[reformjs-message]");this._inputElement=h,this._messageElement=u,this._baseElement=i,this.initialField.placeholder&&(h.placeholder=this.initialField.placeholder),h.addEventListener("input",t=>{const i=t.target;let s;s="checkbox"===e.inputType?i.checked:"number"===e.inputType?i.valueAsNumber:i.value,this.changeValue(s)}),i.appendChild(c)}changeValue(e){this.rawValue=e,this.rawToFinalValue?this.value=this.rawToFinalValue(e):this.value=e,this.parentSectionReflection.valueChanged(),this.validate()}validate(){var e;this.validationErrors={};for(let t=0;t<(null===(e=this.initialField.validations)||void 0===e?void 0:e.length);t++){const e=this.initialField.validations[t];e&&(e.method(this.value)||(this.validationErrors[e.name]={invalid:!0,message:e.message}))}this.setValidationText()}setValidationText(){const e=this._messageElement,t=Object.keys(this.validationErrors);t.length>0&&this.showErrorMessage?(e.style.display="block",e.textContent=this.validationErrors[t[0]].message):(e.style.display="none",e.textContent="")}setValueExternal(e,t=!0){const i=this._inputElement,s=this.initialField.inputType;"checkbox"===s?i.checked=e:"number"===s&&parseInt(e)?i.valueAsNumber=parseInt(e):i.value=e,t&&this.changeValue(e)}setErrorMessageVisibility(e){this.validate(),this.showErrorMessage=e,this.setValidationText()}}class h extends o{constructor(e,t,i,s){super(),this.parentSectionReflection=s,this.subReflections=[],this.constructReflection(e,t,i,s)}constructReflection(e,t,i,s){this.onValueChange=new n,this.initialField=e;e.root;t.expand(i,e,this)}valueChanged(){this.rawValue=this.collectSectionData(),this.parentSectionReflection?this.parentSectionReflection.valueChanged():this.onValueChange.notify()}getValue(e,t=!1){return this.collectSectionData(e)}dataCollection(e,t){const i=this.subReflections.filter(e=>e.initialField.isInput||e.initialField.isSection);for(let s=0;s<i.length;s++){const n=i[s];if(n.initialField.isInput){const e=n;e.value&&t(e.value,e.initialField.name)}else if(n.initialField.isSection){const i=n,s=i.collectSectionData(e);s&&("object"!=typeof s||Object.keys(s).length>0)&&t(s,i.initialField.name)}}}convertDataByMode(e,t){return"final"===t&&this.initialField.convertToFinalValue?this.initialField.convertToFinalValue(e):e}collectSectionData(e="final"){if(this.initialField.arraySectionRaw){const t=[];return this.dataCollection(e,e=>{t.push(e)}),this.convertDataByMode(t,e)}{const t={};return this.dataCollection(e,(e,i)=>{t[i]=e}),this.convertDataByMode(t,e)}}collectValidationErrors(){const e=this.initialField.name?`${this.initialField.name}.`:"",t={};for(let i=0;i<this.subReflections.length;i++){const s=this.subReflections[i];if(s.initialField.isInput){const i=s;i.validate(),t[e+s.initialField.name]=i.validationErrors}else if(s.initialField.isSection){const i=s.collectValidationErrors();for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s)){const n=i[s];null!=n&&Object.keys(n).length>0&&(t[e+s]=n)}}}return t}setValue(e){if(e instanceof Object){const t=e;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const i=t[e];if("function"!=typeof i&&"__proto__"!=e){const t=this.findSubReflectionByName(e);t.initialField.isSection?t.setValue(i):t.initialField.isInput&&t.setValueExternal(i)}}}}findSubReflectionByName(e){var t;return null===(t=this.subReflections)||void 0===t?void 0:t.find(t=>t.initialField.name===e)}setErrorMessageVisibility(e){for(let t=0;t<this.subReflections.length;t++){this.subReflections[t].setErrorMessageVisibility(e)}}}return e.ElementField=class extends t{constructor(e){super(e),this.isElement=!0,this.attributes=[],this.tag="",this.id="",this.class="",i(e,this)}},e.ElementReflection=r,e.EmailValidator=class{constructor(){this.regex=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+\/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,this.message="Please enter valid email address",this.name="email"}method(e){return this.regex.test(e||"")}},e.InitialFied=t,e.InputField=class extends t{constructor(e){super(e),this.isInput=!0,i(e,this),this.convertToFinalValue=e.convertToFinalValue}},e.InputReflection=c,e.MaximumNumber=class{constructor(e){this.maximumValue=e,this.name="min",this.message="",this.message="Value is need to be less or equal than "+e}method(e){return parseFloat(e)<=this.maximumValue}},e.MinimumNumber=class{constructor(e){this.minimumValue=e,this.name="min",this.message="Value is need to be greater or equal than "+e}method(e){return parseFloat(e)>=this.minimumValue}},e.NeedToBeTrue=class{constructor(){this.name="notEmpty",this.message="Please don't leave this area empty "}method(e){return!!e}},e.NotEmpty=class{constructor(){this.name="notEmpty",this.message="Please don't leave this area empty "}method(e){return null!=e&&""!=e.trim()}},e.NumberGreaterThan=class{constructor(e){this.minimumValue=e,this.name="min",this.message="Value is need to be greater than "+e}method(e){return parseFloat(e)>this.minimumValue}},e.NumberLessThan=class{constructor(e){this.maximumValue=e,this.name="min",this.message="",this.message="Value is need to be less than "+e}method(e){return parseFloat(e)<this.maximumValue}},e.Reflection=o,e.Reflector=class{constructor(e){this.rootManifest=e,this.idMap={},this.onValueChange=new n}expandThere(e){this.baseElement=null,this.baseElement="string"==typeof e?document.querySelector(e):e,this.baseElement&&(this.rootSectionReflection=new h(this.rootManifest,this,this.baseElement,null),this.rootSectionReflection.onValueChange.subscribe(new a(e=>{this.onValueChange.notify(e)})))}expand(e,t,i){var s;const n=t.content,l=[];if(n instanceof Array){for(let t=0;t<n.length;t++){const a=n[t];let o;a.isSection&&(o=new h(a,this,e,i)),a.isElement&&(o=new r(a,this,e,i)),a.isInput&&(o=new c(a,this,e,i)),i&&o&&!a.isElement&&(i.subReflections.push(o),l.push(o)),(null===(s=null==o?void 0:o.initialField)||void 0===s?void 0:s.id)&&(this.idMap[o.initialField.id]=o)}return l}}findReflectionById(e){return this.idMap[e]}getValue(e=!0){return this.rootSectionReflection.getValue(e?"final":"raw")}patchValue(e,t=!1){this.rootSectionReflection.setValue(e)}setErrorMessageVisibility(e){this.rootSectionReflection.setErrorMessageVisibility(e)}},e.RootSectionField=class extends s{constructor(){super(...arguments),this.name="root",this.root=!0}},e.SectionField=s,e.SectionReflection=h,e}({});