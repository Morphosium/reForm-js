var reform=function(t){"use strict";var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return function(t){this.content=t.content}}();function o(t,e){for(var i in t)if("__proto__"!=i&&Object.prototype.hasOwnProperty.call(t,i)&&"function"!=typeof t[i]){var n=t[i];e[i]=n}}var r=function(t){function e(e){var i=t.call(this,e)||this;return i.isElement=!0,i.attributes=[],i.tag="",i.id="",i.class="",o(e,i),i}return i(e,t),e}(n),a=function(t){function e(e){var i=t.call(this,e)||this;return i.isInput=!0,o(e,i),i.convertToFinalValue=e.convertToFinalValue,i}return i(e,t),e}(n),l=function(t){function e(e){var i=t.call(this,e)||this;return i.isSection=!0,i.root=!1,o(e,i),i.convertToFinalValue=e.convertToFinalValue,i}return i(e,t),e}(n),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="root",e.root=!0,e}return i(e,t),e}(l),u=function(){function t(){this.regex=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,this.message="Please enter valid email address",this.name="email"}return t.prototype.method=function(t){return this.regex.test(t||"")},t}(),c=function(){function t(){this.name="notEmpty",this.message="Please don't leave this area empty "}return t.prototype.method=function(t){return null!=t&&""!=t.trim()},t}(),h=function(){function t(){this.name="notEmpty",this.message="Please don't leave this area empty "}return t.prototype.method=function(t){return!!t},t}(),f=function(){function t(t){this.minimumValue=t,this.name="min",this.message="Value is need to be greater or equal than "+t}return t.prototype.method=function(t){return parseFloat(t)>=this.minimumValue},t}(),p=function(){function t(t){this.maximumValue=t,this.name="min",this.message="",this.message="Value is need to be less or equal than "+t}return t.prototype.method=function(t){return parseFloat(t)<=this.maximumValue},t}(),d=function(){function t(t){this.minimumValue=t,this.name="min",this.message="Value is need to be greater than "+t}return t.prototype.method=function(t){return parseFloat(t)>this.minimumValue},t}(),v=function(){function t(t){this.maximumValue=t,this.name="min",this.message="",this.message="Value is need to be less than "+t}return t.prototype.method=function(t){return parseFloat(t)<this.maximumValue},t}(),m=function(){function t(){this.observers=[]}return t.prototype.notify=function(t){for(var e=0,i=this.observers;e<i.length;e++){i[e].update(this,t)}},t.prototype.subscribe=function(t){-1==this.observers.indexOf(t)&&this.observers.push(t)},t.prototype.unsubscribe=function(t){var e=this.observers.indexOf(t);e>-1&&this.observers.splice(e,1)},t}(),y=function(){return function(){}}(),b=function(t){function e(e){var i=t.call(this)||this;return i.updateEvent=e,i}return i(e,t),e.prototype.update=function(t,e){this.updateEvent(e)},e}(y),g=function(){return function(){}}();function V(t,e,i){var n,o,r=document.createElement(i.tag||"div");i.class&&(r.className=i.class);var a=null===(n=i.attributes)||void 0===n?void 0:n.filter(function(t){return null!=t});if((null==a?void 0:a.length)>0)for(var l=0;l<a.length;l++){var s=a[l];("class"!=s.key&&"style"!=s.key||s.value)&&r.setAttribute(s.key,s.value||"")}for(var u in i.eventBindings||{})if(Object.prototype.hasOwnProperty.call(i.eventBindings,u))for(var c=null===(o=i.eventBindings[u])||void 0===o?void 0:o.filter(function(t){return null!=t}),h=function(i){var n=null==c?void 0:c[i];r.addEventListener(u,function(i){n(t,i,e)})},f=0;f<(null==c?void 0:c.length);f++)h(f);return r}var F=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.elementField=e,r.reflector=i,r.baseElement=n,r.parentSectionReflection=o,r.constructReflection(),r}return i(e,t),e.prototype.constructReflection=function(){this.initialField=this.elementField;var t=V(this,this.reflector,this.elementField);this.baseElement.appendChild(t),"string"==typeof this.elementField.content?t.textContent=this.elementField.content:this.subReflections=this.reflector.expand(t,this.elementField,this.parentSectionReflection),this.element=t},e.prototype.getElementByName=function(t){var e;return null===(e=this.subReflections)||void 0===e?void 0:e.find(function(e){return e.name===t})},e.prototype.setErrorMessageVisibility=function(t){},e}(g),E=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.reflector=i,r.parentSectionReflection=o,r.value="",r.validationErrors={},r.value=e.initialValue,r.initialField=e,r.constructReflection(e,i,n,o),r}return i(e,t),e.prototype.constructReflection=function(t,e,i,n){var o=this;this._baseElement&&(this._baseElement.innerHTML="",this._baseElement.innerText="");var r,a,l=t.template||"\n            <div>$label</div>\n            <div>$input</div>\n            <div>$message</div>";"checkbox"===t.inputType?(r='<input reformjs-input type="checkbox"> <span reformjs-input-label>'+t.label+"</span>",a="<span></span>"):(r='<input reformjs-input type="'+t.inputType+'">',a="<span reformjs-input-label>"+t.label+"</span>");var s=l.replace("$label",a).replace("$input",r).replace("$message","<span reformjs-message></span>"),u=document.createElement("div");u.innerHTML=s;var c=u.querySelector("[reformjs-input]"),h=u.querySelector("[reformjs-message]");this._inputElement=c,this._messageElement=h,this._baseElement=i,this.initialField.placeholder&&(c.placeholder=this.initialField.placeholder),this.initialField.initialValue&&(c.value=this.initialField.initialValue),c.addEventListener("input",function(e){var i,n=e.target;i="checkbox"===t.inputType?n.checked:"number"===t.inputType?n.valueAsNumber:n.value,o.changeValue(i)}),i.appendChild(u)},e.prototype.changeValue=function(t){this.rawValue=t,this.rawToFinalValue?this.value=this.rawToFinalValue(t):this.value=t,this.parentSectionReflection.valueChanged(),this.validate()},e.prototype.validate=function(){var t;this.validationErrors={};for(var e=0;e<(null===(t=this.initialField.validations)||void 0===t?void 0:t.length);e++){var i=this.initialField.validations[e];i&&(i.method(this.value)||(this.validationErrors[i.name]={invalid:!0,message:i.message}))}this.setValidationText()},e.prototype.setValidationText=function(){var t=this._messageElement,e=Object.keys(this.validationErrors);e.length>0&&this.showErrorMessage?(t.style.display="block",t.textContent=this.validationErrors[e[0]].message):(t.style.display="none",t.textContent="")},e.prototype.setValueExternal=function(t,e){void 0===e&&(e=!0);var i=this._inputElement,n=this.initialField.inputType;"checkbox"===n?i.checked=t:"number"===n&&parseInt(t)?i.valueAsNumber=parseInt(t):i.value=t,e&&this.changeValue(t)},e.prototype.setErrorMessageVisibility=function(t){this.validate(),this.showErrorMessage=t,this.setValidationText()},e}(g),R=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.parentSectionReflection=o,r.subReflections=[],r.constructReflection(e,i,n,o),r}return i(e,t),e.prototype.constructReflection=function(t,e,i,n){this.onValueChange=new m,this.initialField=t;t.root;e.expand(i,t,this)},e.prototype.valueChanged=function(){this.rawValue=this.collectSectionData(),this.parentSectionReflection?this.parentSectionReflection.valueChanged():this.onValueChange.notify()},e.prototype.getValue=function(t,e){return this.collectSectionData(t)},e.prototype.dataCollection=function(t,e){for(var i=this.subReflections.filter(function(t){return t.initialField.isInput||t.initialField.isSection}),n=0;n<i.length;n++){var o=i[n];if(o.initialField.isInput){var r=o;r.value&&e(r.value,r.initialField.name)}else if(o.initialField.isSection){var a=o,l=a.collectSectionData(t);l&&("object"!=typeof l||Object.keys(l).length>0)&&e(l,a.initialField.name)}}},e.prototype.convertDataByMode=function(t,e){return"final"===e&&this.initialField.convertToFinalValue?this.initialField.convertToFinalValue(t):t},e.prototype.collectSectionData=function(t){if(void 0===t&&(t="final"),this.initialField.arraySectionRaw){var e=[];return this.dataCollection(t,function(t){e.push(t)}),this.convertDataByMode(e,t)}var i={};return this.dataCollection(t,function(t,e){i[e]=t}),this.convertDataByMode(i,t)},e.prototype.collectValidationErrors=function(){for(var t=this.initialField.name?this.initialField.name+".":"",e={},i=0;i<this.subReflections.length;i++){var n=this.subReflections[i];if(n.initialField.isInput){var o=n;o.validate(),e[t+n.initialField.name]=o.validationErrors}else if(n.initialField.isSection){var r=n.collectValidationErrors();for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a)){var l=r[a];null!=l&&Object.keys(l).length>0&&(e[t+a]=l)}}}return e},e.prototype.setValue=function(t){if(t instanceof Object){var e=t;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=e[i];if("function"!=typeof n&&"__proto__"!=i){var o=this.findSubReflectionByName(i);o.initialField.isSection?o.setValue(n):o.initialField.isInput&&o.setValueExternal(n)}}}},e.prototype.findSubReflectionByName=function(t){var e;return null===(e=this.subReflections)||void 0===e?void 0:e.find(function(e){return e.initialField.name===t})},e.prototype.setErrorMessageVisibility=function(t){for(var e=0;e<this.subReflections.length;e++){this.subReflections[e].setErrorMessageVisibility(t)}},e}(g),S=function(){function t(t){this.rootManifest=t,this.idMap={},this.onValueChange=new m}return t.prototype.expandThere=function(t){var e=this;if(this.baseElement=null,this.baseElement="string"==typeof t?document.querySelector(t):t,!this.baseElement)throw"No provided element. Please make sure element is not null";this.rootSectionReflection=new R(this.rootManifest,this,this.baseElement,null),this.rootSectionReflection.onValueChange.subscribe(new b(function(t){e.onValueChange.notify(t)}))},t.prototype.expand=function(t,e,i){var n,o=e.content,r=[];if(o instanceof Array){for(var a=0;a<o.length;a++){var l=o[a],s=void 0;if(l.isSection&&(s=new R(l,this,t,i)),l.isElement)s=new F(l,this,t,i);l.isInput&&(s=new E(l,this,t,i)),i&&s&&!l.isElement&&(i.subReflections.push(s),r.push(s)),(null===(n=null==s?void 0:s.initialField)||void 0===n?void 0:n.id)&&(this.idMap[s.initialField.id]=s)}return r}},t.prototype.findReflectionById=function(t){return this.idMap[t]},t.prototype.getValue=function(t){return void 0===t&&(t=!0),this.rootSectionReflection.getValue(t?"final":"raw")},t.prototype.patchValue=function(t,e){this.rootSectionReflection.setValue(t)},t.prototype.collectValidationErrors=function(){return this.rootSectionReflection.collectValidationErrors()},t.prototype.setErrorMessageVisibility=function(t){this.rootSectionReflection.setErrorMessageVisibility(t)},t}();return t.ElementField=r,t.ElementReflection=F,t.EmailValidator=u,t.EventObserve=b,t.InitialFied=n,t.InputField=a,t.InputReflection=E,t.MaximumNumber=p,t.MinimumNumber=f,t.NeedToBeTrue=h,t.NotEmpty=c,t.NumberGreaterThan=d,t.NumberLessThan=v,t.ObjectFieldTransfer=o,t.Observer=y,t.Reflection=g,t.Reflector=S,t.RootSectionField=s,t.SectionField=l,t.SectionReflection=R,t.Subject=m,t.createElement=V,t}({});